<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Comisiones</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        h1 {
            color: #1a3c6c;
            text-align: center;
        }
        .input-section {
            margin: 20px 0;
            text-align: center;
        }
        input[type="number"] {
            padding: 10px;
            font-size: 16px;
            width: 200px;
            margin-right: 10px;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
            color: white;
        }
        #calculateBtn {
            background-color: #4CAF50;
        }
        #whatsappBtn {
            background-color: #25D366;
            margin-right: 10px;
        }
        #pdfBtn {
            background-color: #2196F3;
        }
        #results {
            width: 100%;
            max-width: 800px;
            margin-top: 20px;
        }
        .result-container {
            display: flex;
            align-items: center;
            background-color: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .result-container img {
            width: 50px;
            height: 50px;
            margin-right: 20px;
        }
        .result-details {
            flex: 1;
            display: flex;
            justify-content: space-between;
        }
        .result-details span {
            margin-right: 20px;
        }
        .commission, .iva, .total {
            color: #87CEEB; /* Azul claro y suave */
        }
        .net-amount {
            color: #90EE90; /* Verde sutil */
            font-weight: bold;
        }
        #commission-list {
            margin-top: 30px;
            width: 100%;
            max-width: 800px;
            background-color: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        #commission-list h3 {
            margin-top: 0;
            color: #1a3c6c;
        }
        #commission-list ul {
            list-style-type: none;
            padding: 0;
        }
        #commission-list li {
            padding: 5px 0;
        }
    </style>
</head>
<body>
    <h1>Calculadora de Comisiones de Terminales de Venta</h1>
    <div class="input-section">
        <input type="number" id="amount" placeholder="Ingresa el monto de la venta" step="0.01">
        <button id="calculateBtn">Calcular</button>
    </div>
    <div id="results"></div>
    <div>
        <button id="whatsappBtn">Compartir por WhatsApp</button>
        <button id="pdfBtn">Descargar PDF</button>
    </div>
    <div id="commission-list"></div>

    <script>
        const IVA_RATE = 0.16; // 16% IVA en México
        let commissionData = {};

        // Cargar datos del CSV
        Papa.parse("commissions.csv", {
            download: true,
            header: true,
            complete: function(results) {
                results.data.forEach(row => {
                    commissionData[row.Terminal] = {
                        rate: parseFloat(row.Comisión),
                        logo: row.Logo // Asumimos que el CSV incluye URLs de logos
                    };
                });
                displayCommissionList();
            },
            error: function() {
                alert("No se pudo cargar el archivo de comisiones. Verifica el CSV.");
            }
        });

        document.getElementById("calculateBtn").addEventListener("click", calculateCommissions);
        document.getElementById("whatsappBtn").addEventListener("click", shareWhatsApp);
        document.getElementById("pdfBtn").addEventListener("click", downloadPDF);

        function calculateCommissions() {
            const amount = parseFloat(document.getElementById("amount").value);
            if (isNaN(amount) || amount <= 0) {
                alert("Por favor, ingresa un monto válido.");
                return;
            }

            const resultsDiv = document.getElementById("results");
            resultsDiv.innerHTML = "";

            for (const [terminal, data] of Object.entries(commissionData)) {
                const commission = amount * data.rate;
                const iva = commission * IVA_RATE;
                const totalCommission = commission + iva;
                const netAmount = amount - totalCommission;

                const container = document.createElement("div");
                container.className = "result-container";
                container.innerHTML = `
                    <img src="${data.logo}" alt="${terminal} Logo">
                    <div class="result-details">
                        <span class="commission">Comisión: $${commission.toFixed(2)}</span>
                        <span class="iva">IVA: $${iva.toFixed(2)}</span>
                        <span class="total">Comisión total: $${totalCommission.toFixed(2)}</span>
                        <span class="net-amount">Monto neto: $${netAmount.toFixed(2)}</span>
                    </div>
                `;
                resultsDiv.appendChild(container);
            }
        }

        function shareWhatsApp() {
            const amount = parseFloat(document.getElementById("amount").value);
            if (isNaN(amount)) return;

            let message = `Resultados de la Calculadora de Comisiones para $${amount}:\n\n`;
            for (const [terminal, data] of Object.entries(commissionData)) {
                const commission = amount * data.rate;
                const iva = commission * IVA_RATE;
                const totalCommission = commission + iva;
                const netAmount = amount - totalCommission;
                message += `${terminal}:\nComisión: $${commission.toFixed(2)}\nIVA: $${iva.toFixed(2)}\nComisión total: $${totalCommission.toFixed(2)}\nMonto neto: $${netAmount.toFixed(2)}\n\n`;
            }
            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, "_blank");
        }

        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const amount = parseFloat(document.getElementById("amount").value);
            if (isNaN(amount)) return;

            doc.setFontSize(16);
            doc.text("Calculadora de Comisiones", 20, 20);
            doc.setFontSize(12);
            doc.text(`Monto: $${amount.toFixed(2)}`, 20, 30);

            let y = 40;
            for (const [terminal, data] of Object.entries(commissionData)) {
                const commission = amount * data.rate;
                const iva = commission * IVA_RATE;
                const totalCommission = commission + iva;
                const netAmount = amount - totalCommission;

                doc.text(`${terminal}:`, 20, y);
                doc.text(`Comisión: $${commission.toFixed(2)}`, 30, y + 5);
                doc.text(`IVA: $${iva.toFixed(2)}`, 30, y + 10);
                doc.text(`Comisión total: $${totalCommission.toFixed(2)}`, 30, y + 15);
                doc.text(`Monto neto: $${netAmount.toFixed(2)}`, 30, y + 20);
                y += 30;
            }

            doc.save("comisiones.pdf");
        }

        function displayCommissionList() {
            const listDiv = document.getElementById("commission-list");
            listDiv.innerHTML = "<h3>Porcentaje de Comisiones por Terminal</h3><ul></ul>";
            const ul = listDiv.querySelector("ul");

            for (const [terminal, data] of Object.entries(commissionData)) {
                const percentage = (data.rate * 100).toFixed(2);
                const li = document.createElement("li");
                li.textContent = `${terminal}: ${percentage}%`;
                ul.appendChild(li);
            }
        }
    </script>
</body>
</html>
